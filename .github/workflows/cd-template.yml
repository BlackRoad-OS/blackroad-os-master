name: CD – Deploy

# This is a reusable CD template for BlackRoad OS repositories
# It handles deployment to Railway or other platforms

on:
  push:
    branches:
      - main
  release:
    types: [published]

jobs:
  deploy:
    runs-on: ubuntu-latest
    # Only run on main branch or releases
    if: github.ref == 'refs/heads/main' || github.event_name == 'release'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Example: Deploy to Railway
      # Requires RAILWAY_TOKEN secret to be set in repository settings
      - name: Deploy to Railway
        run: |
          echo "Deploying to Railway..."
          # Install Railway CLI
          # npm i -g @railway/cli
          # railway up --service ${{ secrets.RAILWAY_SERVICE_ID }}
          echo "Note: Set RAILWAY_TOKEN in repository secrets"
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

      # Example: Deploy to other platforms
      # - name: Deploy to Vercel
      #   uses: amondnet/vercel-action@v25
      #   with:
      #     vercel-token: ${{ secrets.VERCEL_TOKEN }}
      #     vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
      #     vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}

      # - name: Deploy to Fly.io
      #   uses: superfly/flyctl-actions/setup-flyctl@master
      # - run: flyctl deploy --remote-only
      #   env:
      #     FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}

      - name: Deployment complete
        run: echo "Deployment completed successfully"

  notify:
    runs-on: ubuntu-latest
    needs: deploy
    if: always()
    steps:
      - name: Notify deployment status
        run: |
          if [ "${{ needs.deploy.result }}" == "success" ]; then
            echo "✅ Deployment successful"
          else
            echo "❌ Deployment failed"
          fi
        # Add notification integrations here (Slack, Discord, etc.)
